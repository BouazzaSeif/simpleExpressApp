var { User } = require("../models/user.model");
var users = [];
var idAutoGenerated = 0;

// Display list of all Users.
exports.getAllUsers = function (req, res) {
  if (users.length !== 0) {
    res.json(users);
    return;
  }
  res.status(404).send("No User found");
};

// addd new user .
exports.addNewUser = function (req, res) {
  if (users.find((u) => u.email === req.body.email) === undefined) {
    req.body.id = idAutoGenerated + 1;
    users.push(User.fromObject(req.body));
    idAutoGenerated++;
    res.status(200).send("The user added successfully");
    return;
  }
  res
    .status(500)
    .send("problem occured : please try to change the email adress");
};

// find User By  Id  form on GET.
exports.findUserById = function (req, res) {
  let user = users.find((u) => u.id === req.params.id);
  console.log(user);
  if (user) {
    res.json(user);
    return;
  }
  res.status(500).send("No user found with this id ", req.params.id);
};

// Delete User from DELETE.
exports.deleteUser = function (req, res) {
  let isUserExist = users.find((u) => u.id === req.params.id) || false;
  if (isUserExist) {
    users = users.filter((user) => user.id !== req.params.id);
    res.status(200).send("The user deleted successfully");
    return users;
  }
  res.status(500).send("problem occured while deleting the user");
};

// Update User from put.
exports.updateUser = function (req, res) {
  let userToUpdate = users.find((u) => u.id === req.params.id) || false;
  if (users.find((u) => u.id === req.params.id)) {
    userToUpdate = users.find((u) => u.id === req.params.id);
    let userJson = {
      id: req.params.id,
      fisrtName: req.body.fisrtName || userToUpdate.fisrtName,
      lastName: req.body.lastName || userToUpdate.lastName,
      email: userToUpdate.email,
      age: req.body.age || userToUpdate.age,
    };
    userToUpdate = User.fromObject(userJson);
    users.splice(
      users.findIndex((u) => u.email === userToUpdate.email),
      1,
      userToUpdate
    );
    res.status(200).send("the use updated successufully");
    return;
  }
  res.status(500).send("problem occured while add the user");
};
